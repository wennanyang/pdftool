## 背景
广勘白云分院实习期做的开发程序
## 项目简介
给定两个文件夹，放线和验收，里面包含若干需要提取属性的excel和word，文件组织如下
```
|--- 放线
|   |--- 2021放23B141
|   |   |--- 2021放23B141.txt
|   |--- 2021放23B314
|   |--- ...
|   |--- ...
|--- 验收
|   |--- 2021复23B133
|   |   |--- 技术审查表.xls
|   |   |--- 成果汇总表.doc
|   |--- 2021复23B160
|   |--- 2021复23B162
|   |--- ...
```
从中提取属性，然后汇总成两个表格

## 使用说明
1. 选择放线验收文件夹后, 点击执行即可输出对应的汇总表
2. 选择清单路径后即可验证哪些项目没有完成

如果单独执行清单验证, 程序路径下必须要有`放线数据汇总表.xlsx`或者`验收成果汇总表.xlsx` 

**输出** 
```
|--- 异常的放线项目
|   |--- 2021放23B141
|   |--- 2021放23B314
|   |--- ...
|--- 异常的验收项目
|   |--- 2021复23B133
|   |--- 2021复23B160
|   |--- ...
|--- 放线验收缺失的项目列表.txt
|--- 异常文件汇总
|   |--- 放线提取异常的txt
|   |--- 验收提取为空的xls
|   |--- 验收提取异常的doc
|   |--- 验收提取异常的xls
|   |--- log.txt
|   |--- 放线没有txt的项目.txt
|   |--- 复制的文件名.txt
```
- `异常的放线项目` `异常的验收项目`都是发生异常的项目
- `放线验收缺失的项目列表.txt`是经过验证后缺失的项目
- `放线提取异常的txt`是`工程编号`提取失败或者文件打开失败
- `验收提取为空的xls`是`建筑高度`提取为空的`技术审查.xls`
- `验收提取异常的doc` `验收提取异常的xls`是访问到了位置不存在的单元格或者文件打开失败
- `log.txt`是异常输出
- `放线没有txt的项目.txt`是放线项目下没有`txt`的汇总
- `复制的文件名.txt`是`验收提取为空的xls`、`验收提取异常的doc`、`验收提取异常的xls`复制的具体文件列表

## 需求分析
1. 从放线验收两个文件夹中提取相应的属性，汇总成两个Excel表格
2. 比较提取成功的项目和清单列表的差异
3. 制作GUI界面
4. 异常处理

## 技术路线
**1. 技术审查Excel提取**
- 采用`xlrd3`库, 可以识别`xls`和`xlsx`两种文件格式
- 查找Excel文件下的`验收`表，如果`验收`不存在则无法提取数据
- 在`(27, B)` `(27, C)` `(28, B)` `(28, C)`中查找含`建筑高度`的单元格
- 查`(27, E)` `(27, F)` `(28, E)` `(28, F)`的对应的建筑高度

**有些文件上述对应关系不准确，如果查找的建筑高度为空会报异常**
  
**2. Word文件操作**
- 读取 本次Word都是表格类型的数据，直接采用`pywin32`库, 对Word文件自动化操作
- 按照每个属性对应的绝对位置提取内容具体如下

|属性名称|  表1位置    |   |属性名称|  表2位置    |
|-------|--------  |-------|-------|-------- |
|工程编号|路径中提取|   |总建筑面积|(2, 5)|
|建筑结构|         |   |地上面积|(3, 6)|
|建设单位|(1, 2)    |   |地下面积|(4, 6)|
|建设项目名称|(2, 2)|   |地上层数|(5, 5)|
|建设位置|(3, 2)    |   |地下层数|(6, 5)|
|建设工程规划许可证号|(7, 2)|   |主要功能|(10, 2)&(11, 2)&(12, 2)|
|相关批文号|(8, 2)  |   |建筑高度|      |
|放线案号|(9, 2)    |   |更新时间|      |
|建设规模|(11, 2)   |   |备注    |      |
|基底面积|(13, 4)   |
|住宅户数|(17, 4)   |
|汽车泊位|(16, 4)   |

**3. txt文件操作**
|属性名称|  行数  |
|-------|--------|
|工程编号|(22, end)|
|建筑结构|        |
|建设单位|   5    |
|建设项目|   2    |
|建设位置|   4    |
|建设规模|   3    |
|放线依据|   0    |
|用地许可证号|   1    |
|更新时间|        |
|备注   |        |

**4. 和清单比较差异**
- 寻找程序路径下`放线数据汇总.xlsx`和`验收成果汇总表.xlsx`两个文件
- 提取两个的文件的`工程编号`,与指定清单路径的做对比

**5. GUI界面制作**
- 界面元素包括3个Label, 3个Checkout, 4个Button, 1个ProgressBar
- 选择放线、验收目录和清单路径，点击执行按钮即可执行, ProgressBar实时显示进度

**6. 异常处理** 

放线 
1. 项目下不存在`txt`文件
2. `txt`文件下的`工程编号`不存在或者为空
3. `成果汇总.doc`格式有误, 单元格位置不存在
4. `工程编号`在文件的最下方，位置不固定，只能估计大致区间在这个区间内寻找，利用正则表达式匹配是否找到了项目名称，或者项目名称是否有误
  
验收
1. `技术审查.xls`建筑高度提取为空, 或者提取失败
2. `成果汇总.doc`格式有误, 单元格位置不存在

对于以上异常，会将异常的具体文件复制到文件夹下，并将异常的整个项目复制

## 打包命令
```shell
pip install pyinstaller=5.13
pyinstaller -F -c -w -i .ico\cloud.ico gui.py --hidden-import openpyxl.cell._writer
# 或者采用sepc文件
pyinstaller .\gui.spec
```

